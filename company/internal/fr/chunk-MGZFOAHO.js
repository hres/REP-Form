import{$ as _,Aa as N,Ab as D,Ba as ce,Bb as Ne,Ca as me,Cb as $,D as b,Da as de,Db as W,E as oe,Ea as ue,Eb as Oe,Fa as he,Fb as je,G as r,Ga as ve,H as u,Ha as fe,Ia as _e,J as g,Ja as ye,M as p,Ma as O,N as se,O as a,Oa as Ee,P as s,Pa as ge,Q as F,Qa as j,R as Z,Ra as Ce,S as ee,Sa as Se,T as L,U as v,Ua as Ie,V as h,Va as be,W as x,Wa as X,X as T,Xa as ie,Y as M,Ya as q,Z as l,Za as Fe,_ as f,_a as Le,a as J,ab as U,c as K,ca as ae,d as re,da as R,ea as m,eb as xe,f as w,fa as d,ga as le,hb as H,ia as te,ib as Te,kb as Me,lb as we,mb as Ae,o as ne,oa as V,pa as P,q as B,qb as A,rb as Be,t as S,tb as G,u as I,ub as Re,vb as Q,wb as Ve,xb as z,ya as pe,yb as Pe,za as k,zb as ke}from"./chunk-S6NW4OFF.js";function We(o,y){o&1&&(a(0,"div",2)(1,"p"),l(2),m(3,"translate"),s()()),o&2&&(r(2),f(d(3,1,"amend.alert")))}function Ye(o,y){o&1&&(Z(0),a(1,"p"),l(2,'First time users of this form cannot select a file to load and must create an XML file by completing all the required fields below and clicking the "Save draft XML" button at the bottom of this form. '),s(),a(3,"p"),l(4,"For subsequent uses of this form, upload "),a(5,"u"),l(6,"the last final XML file"),s(),l(7,", you received from Health Canada, by clicking on the \u201CChoose file\u201D button and selecting the XML file. If you do not have the final XML file, contact client information unit at "),a(8,"a",6),l(9,"client.information@hc-sc.gc.ca"),s(),l(10,"."),s(),a(11,"p"),l(12,'If you partially complete the form and click on the "Save working copy" button at the bottom of the form, it will save a copy on the local workstation for completion at later time. The file will be saved in the .hcsc file format. The working copies (files with extension .hcsc) should never be sent Health Canada and must be finalized prior to sending.'),s(),ee())}function Je(o,y){o&1&&(Z(0),a(1,"p"),l(2,"Les nouveaux utilisateurs de ce formulaire ne peuvent pas s\xE9lectionner un fichier \xE0 charger et doivent cr\xE9er un fichier XML en remplissant tous les champs obligatoires ci-dessous et en cliquant sur le bouton \xAB Enregistrer le brouillon XML \xBB au bas de ce formulaire."),s(),a(3,"p"),l(4,"Pour les utilisations subs\xE9quentes de ce formulaire, t\xE9l\xE9chargez "),a(5,"u"),l(6,"le dernier fichier XML final"),s(),l(7," que vous avez re\xE7u de Sant\xE9 Canada, en cliquant sur le bouton \xAB Choisir un fichier \xBB et en s\xE9lectionnant le fichier XML. Si vous ne disposez pas du fichier XML final, contactez l'unit\xE9 d'information client \xE0 "),a(8,"a",6),l(9,"client.information@hc-sc.gc.ca"),s(),l(10,"."),s(),a(11,"p"),l(12,"Si vous remplissez partiellement le formulaire et cliquez sur le bouton \xAB Enregistrer la copie de travail \xBB au bas du formulaire, il enregistrera une copie sur le poste de travail local pour qu'elle soit compl\xE9t\xE9e ult\xE9rieurement. Le fichier sera enregistr\xE9 au format de fichier .hcsc. Les copies de travail (fichiers avec extension .hcsc) ne doivent jamais \xEAtre envoy\xE9es \xE0 Sant\xE9 Canada et doivent \xEAtre finalis\xE9es avant l'envoi."),s(),ee())}function Ke(o,y){if(o&1&&(a(0,"div",3)(1,"div",4),g(2,Ye,13,0,"ng-container",5)(3,Je,13,0,"ng-container",5),s()()),o&2){let t=h();r(2),p("ngIf",t.lang==="en"),r(),p("ngIf",t.lang==="fr")}}var Xe=(()=>{class o{constructor(t){this._globalService=t,this.showFieldErrors=!1,this.showFieldErrors=!1}ngOnInit(){this.isInternal=this._globalService.isInternal}static{this.\u0275fac=function(i){return new(i||o)(u(G))}}static{this.\u0275cmp=B({type:o,selectors:[["app-filereader-instruction"]],inputs:{lang:"lang",isInternal:"isInternal",isStatusFinal:"isStatusFinal"},standalone:!0,features:[R],decls:2,vars:2,consts:[["role","alert","class","alert alert-info",4,"ngIf"],["class","row",4,"ngIf"],["role","alert",1,"alert","alert-info"],[1,"row"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[4,"ngIf"],["href","mailto:client.information@hc-sc.gc.ca"]],template:function(i,e){i&1&&g(0,We,4,3,"div",0)(1,Ke,4,2,"div",1),i&2&&(p("ngIf",e.isStatusFinal),r(),p("ngIf",!e.isInternal))},dependencies:[P,V,N,k],encapsulation:2})}}return o})();function Ze(o,y){if(o&1&&(F(0,"control-messages",33),m(1,"formControl")),o&2){let t=h(2);p("showError",t.showErrors)("control",d(1,2,t.coForm.controls.certifyPrivacy))}}function et(o,y){if(o&1){let t=L();a(0,"div",27)(1,"div",28)(2,"label",29)(3,"input",30),v("blur",function(){S(t);let e=h();return I(e.processErrors())}),s(),a(4,"strong"),l(5),m(6,"translate"),s(),a(7,"strong",31),l(8),m(9,"translate"),s(),g(10,Ze,2,4,"control-messages",32),s()()()}if(o&2){let t=h();r(3),p("formControlName","certifyPrivacy"),r(2),_(" ",d(6,4,"consent.privacy"),""),r(3),f(d(9,6,"commmon.required.bracket")),r(2),p("ngIf",t.coForm.controls.certifyPrivacy.invalid)}}function tt(o,y){if(o&1){let t=L();a(0,"div",34)(1,"button",35),v("click",function(){S(t);let e=h();return I(e.saveWorkingCopyFile())}),l(2),m(3,"translate"),s()()}o&2&&(r(2),_(" ",d(3,1,"save.working.copy")," "))}function it(o,y){if(o&1){let t=L();a(0,"div",34)(1,"button",36),v("click",function(){S(t);let e=h();return I(e.saveXmlFile())}),l(2),m(3,"translate"),s()()}o&2&&(r(2),_(" ",d(3,1,"generate.final")," "))}function rt(o,y){if(o&1){let t=L();a(0,"div",34)(1,"button",37),v("click",function(){S(t);let e=h();return I(e.saveXmlFile())}),l(2),m(3,"translate"),s()()}if(o&2){let t=h();r(),p("disabled",t.isAmend()),r(),_(" ",d(3,2,"draft.xml")," ")}}function nt(o,y){if(o&1){let t=L();a(0,"div",34)(1,"a",38),v("click",function(){S(t);let e=h();return I(e.mailto())}),l(2),m(3,"translate"),s()()}if(o&2){let t=h();r(),se("disabled",t.disableMailto),p("href",t.mailToLink,b),r(),_(" ",d(3,4,"mailto.label")," ")}}function ot(o,y){if(o&1&&(a(0,"div",27),F(1,"app-mailto-help",39),s()),o&2){let t=h();r(),p("email",t.submitToEmail)("subject",t.submitToSubject)("lang",t.lang)}}var qt=(()=>{class o{constructor(t,i,e,n,c,C,E,Y,Ue,He,Ge){this._fb=t,this.cdr=i,this._baseService=e,this._globalService=n,this._utilsService=c,this.fileServices=C,this._versionService=E,this._checkSumService=Y,this._companyContactService=Ue,this._companyAddressService=He,this._translateService=Ge,this._companyEnrolmentErrors=[],this._contactListErrors=[],this._contactCompanyRoleErrors=[],this._addressListErrors=[],this._addressCompanyRoleErrors=[],this._productLineErrors=[],this._consentPrivacyError=[],this.errorList=[],this.headingLevel="h2",this.rootTagText=H,this.versionTagPath=Te,this.startCheckSumVersionNum=5,this.isStatusFinal=!1,this.mailToLabel="mailto.label",this.disableMailto=!1,this.showMailToHelpText=!1,this.mailToLink="",this.submitToEmail="",this.submitToSubject="",this.popupId="saveXmlPopup",this._signalService=ne(Re),this.selectedContactCompanyRoles=this._signalService.getSelectedContactCompanyRoles(),this.selectedAddressCompanyRoles=this._signalService.getSelectedAddressCompanyRoles(),this.showErrors=!1,te(()=>{this.processAddressCompanyRolesErrors()}),te(()=>{this.processContactCompanyRolesErrors()})}ngOnInit(){this.coForm||(this.coForm=this._baseService.getReactiveModel(this._fb));try{this._globalService.enrollment?this.enrollModel=this._globalService.enrollment:(this.enrollModel=this._baseService.getEmptyEnrol(),this._globalService.enrollment=this.enrollModel),this.companyEnrolModel=this.enrollModel[this.rootTagText],this._initModels(this.companyEnrolModel),this.lang=this._globalService.currLanguage,this.helpIndex=this._globalService.helpIndex,this.devEnv=this._globalService.devEnv,this.byPassCheckSum=this._globalService.byPassChecksum,this.isInternal=this._globalService.isInternal}catch(t){console.error(t)}}ngAfterViewInit(){document.location.href="#def-top",this.msgList.changes.subscribe(t=>{let i=[];this._updateErrorList(t),this.processErrors()}),this.msgList.notifyOnChanges()}_updateErrorList(t){let i=[];t&&t.forEach(e=>{e.label==="consent.privacy"&&i.push(e)}),this._consentPrivacyError=i}processErrors(){this.errorList=[].concat(this._companyEnrolmentErrors,this._addressCompanyRoleErrors,this._addressListErrors,this._contactCompanyRoleErrors,this._contactListErrors,this._productLineErrors,this._consentPrivacyError),this.disableMailto=this.errorList.length>0||this.isInternal,this.showMailToHelpText=!1,this.cdr.detectChanges()}processCompanyEnrolmentErrors(t){this._companyEnrolmentErrors=t,this.processErrors()}processProductLineErrors(t){this._productLineErrors=t,this.processErrors()}processContactListErrors(t){this._contactListErrors=t,this.processErrors()}processAddressListErrors(t){this._addressListErrors=t,this.processErrors()}processContactCompanyRolesErrors(){let t=[];this.isRolesMissing(this.selectedContactCompanyRoles())&&t.push(this._companyContactService.makeMissingRoleError()),this._contactCompanyRoleErrors=t,this.processErrors()}processAddressCompanyRolesErrors(){let t=[];this.isRolesMissing(this.selectedAddressCompanyRoles())&&t.push(this._companyAddressService.makeMissingRoleError()),this._addressCompanyRoleErrors=t,this.processErrors()}isRolesMissing(t){let i=this._globalService.companyRolesList.map(n=>n.id),e=t.map(n=>n.replace(/^\d+/,""));return i.some(n=>!e.includes(n))}hideErrorSummary(){return this.showErrors&&this.errorList&&this.errorList.length>0}saveXmlFile(){this.showErrors=!0,this.processErrors(),this.errorList&&this.errorList.length>0?document.location.href="#topErrorSummaryId":this.companyAddressListComponent.recordFormGroup.pristine&&this.companyContactListComponent.recordFormGroup.pristine?this._saveXML():this.openPopup()}openPopup(){jQuery("#"+this.popupId).trigger("open.wb-overlay")}saveWorkingCopyFile(){let t=this._prepareForSaving(!1),i=this._generateFileName(t[H]);this.fileServices.saveJsonToFile(t,i,null)}processFile(t){if(t.data!==null)if(this.companyEnrolModel=t.data.COMPANY_ENROL,this._initModels(this.companyEnrolModel),this.companyEnrolModel.software_version<this._globalService.appVersion){let i=String(this.companyEnrolModel.application_type);this.isStatusFinal=i===A.FINAL}else this.isStatusFinal=this.companyEnrolModel.application_type._id==A.FINAL}_initModels(t){let i=t.address_record,e=Array.isArray(i)?i:[i];this.addressListModel=t.software_version<this._globalService.appVersion?this._mapAddressIdToId(e):e,this._utilsService.isEmpty(i)&&(this.addressListModel=[]);let n=t.contact_record,c=Array.isArray(n)?n:[n];this.contactListModel=t.software_version<this._globalService.appVersion?this._mapContactIdToId(c):c,this._utilsService.isEmpty(n)&&(this.contactListModel=[])}_mapAddressIdToId(t){return t.map(n=>{var c=n,{address_id:i}=c,e=K(c,["address_id"]);return J({id:i},e)})}_mapContactIdToId(t){return t.map(n=>{var c=n,{contact_id:i}=c,e=K(c,["contact_id"]);return J({id:i},e)})}unloadNotification(t){t.returnValue=!0}_saveXML(){if(this.errorList&&this.errorList.length<1){let t=this._prepareForSaving(!0),i=this._generateFileName(t[H]),e=this._versionService.getApplicationMajorVersionWithUnderscore(this._globalService.appVersion),n=Ae.toUpperCase()+"_CO_"+e+".xsl";this.fileServices.saveXmlToFile(t,i,!0,n);return}document.location.href="#topErrorSummaryId"}isAmend(){return this.companyEnrolModel.application_type._id===A.FINAL?!this.isInternal&&this.isStatusFinal:this.companyEnrolModel.software_version<this._globalService.appVersion&&String(this.companyEnrolModel.application_type)===A.FINAL?!this.isInternal&&this.isStatusFinal:!1}_prepareForSaving(t){let i=null,e=null,n=this._baseService.getEmptyCompanyEnrol();n.date_saved=this._utilsService.getFormattedDate("yyyy-MM-dd-hhmm"),n.software_version=this._globalService.appVersion,n.form_language=this._globalService.currLanguage;let c=this.companyEnrolmentComponent.getFormValue(),C=this.productLineComponent.getFormValue();this.companyAddressListComponent.recordFormArray&&(e=this.companyAddressListComponent.recordFormArray.value),this.companyContactListComponent.recordFormArray&&(i=this.companyContactListComponent.recordFormArray.value),this._baseService.mapCompanyEnrolmentToOutput(n,c,this.isInternal,t),this._baseService.mapProductLineToOutput(n,C),this._baseService.mapContactsFormToOutput(n,i),this._baseService.mapAddressesFormToOutput(n,e),this.outputModel=n;let E={COMPANY_ENROL:n};return t&&(E.COMPANY_ENROL[ie]="",E.COMPANY_ENROL[ie]=this._checkSumService.createHash(E)),console.log("_prepareForSaving ~ output",JSON.stringify(E,null,2)),E}_generateFileName(t){let i=t.company_id,e=t.enrolment_version.replace(/\./g,"-"),n=this.isInternal?we:Me;return i?`${n}-${i}-${e}`:`${n}-${e}`}mailto(){return re(this,null,function*(){this.showMailToHelpText=!0;let t="",i="",n=this.companyEnrolmentComponent.getFormValue().companyId,c=null;this.companyAddressListComponent.recordFormArray&&(c=this.companyAddressListComponent.recordFormArray.value);let C=this._findCompanyNameMFRrole(c);this.submitToSubject=yield w(this._translateService.get("email.subject")),this.submitToEmail=yield w(this._translateService.get("email.to"));let E=yield w(this._translateService.get("email.draft"));i=yield w(this._translateService.get("email.body"));let Y=this.submitToEmail.replace(/[()]/g,"").trim();t=E+(C===null||C===""?"[company name]":C)+" "+(n===""?" ":" - "+n),i=i,this.mailToLink=`mailto:${Y}?subject=${t}&body=${i}`})}onChanged(t,i){t?.target?.checked===!1&&this.coForm.controls[i].reset()}_findCompanyNameMFRrole(t){let i=t.find(e=>e.addressInfo.selectedAddressCompanyRoles.includes(Be.MFR));return i?i.addressInfo.companyName:null}isEarlyVersion(){return this._versionService.getMajorVersion(this.companyEnrolModel.software_version)<5}static{this.\u0275fac=function(i){return new(i||o)(u(_e),u(le),u(W),u(G),u(j),u(X),u(U),u(q),u(ke),u(Ve),u(pe))}}static{this.\u0275cmp=B({type:o,selectors:[["app-form-base"]],viewQuery:function(i,e){if(i&1&&(x(Q,5),x(D,5),x(z,5),x($,5),x(O,5)),i&2){let n;T(n=M())&&(e.companyEnrolmentComponent=n.first),T(n=M())&&(e.companyContactListComponent=n.first),T(n=M())&&(e.companyAddressListComponent=n.first),T(n=M())&&(e.productLineComponent=n.first),T(n=M())&&(e.msgList=n)}},hostBindings:function(i,e){i&1&&v("beforeunload",function(c){return e.unloadNotification(c)},!1,oe)},standalone:!0,features:[ae([X,j,U,q,be,Ie,W]),R],decls:78,vars:80,consts:[[3,"id","title","message","close"],[1,"container-fluid","wb-frmvld","wb-init","wb-frmvld-inited"],["name","coForm","novalidate","",3,"formGroup"],[1,"row","mrgn-tp-md"],[1,"col-md-12"],[1,"text-right"],["id","securityInfo",1,"fa","fa-shield","fa-sm"],[1,"panel","panel-primary","mrgn-tp-lg"],[1,"panel-heading","clearfix"],[1,"panel-title"],[3,"id"],[1,"fn-lnk","mrgn-tp-md",3,"href"],[1,"wb-inv"],[1,"panel-body"],[3,"complete","rootTag","lang","versionTagPath","startCheckSumVersion","byPassCheckSum","devEnv"],["fileUploadInstruction","",3,"lang","isInternal","isStatusFinal"],["id","topErrorSummaryId"],["headingPreamble","errorSummary.form.name",3,"hiddenSummary","errorList","headingLevel"],[3,"errorList","showErrors","dataModel","isInternal"],[1,"panel","panel-default"],[1,"fn-lnk",3,"href"],[3,"errorEmit","recordList","showErrors","isInternal","earlyVersion"],[3,"errorEmit","recordList","showErrors","isInternal"],[3,"errorList","showErrors","dataModel"],["class","row",4,"ngIf"],[1,"row","btn-group-sm"],["class","form-group col-md-4",4,"ngIf"],[1,"row"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],["for","certifyPrivacy",1,"required"],["type","checkbox","id","certifyPrivacy","required","",3,"blur","formControlName"],[1,"required"],["parentId","coForm","controlId","certifyPrivacy","label","consent.privacy",3,"showError","control",4,"ngIf"],["parentId","coForm","controlId","certifyPrivacy","label","consent.privacy",3,"showError","control"],[1,"form-group","col-md-4"],["type","button",1,"btn","btn-default","btn-lg","active",3,"click"],["type","button",1,"btn","btn-primary","btn-lg","active",3,"click"],["type","button",1,"btn","btn-primary","btn-lg","active",3,"click","disabled"],[1,"btn","btn-primary","btn-lg","active",3,"click","href"],[3,"email","subject","lang"]],template:function(i,e){i&1&&(F(0,"lib-popup",0),m(1,"translate"),m(2,"translate"),m(3,"translate"),a(4,"div",1)(5,"form",2)(6,"div",3)(7,"div",4)(8,"div",5)(9,"span",6)(10,"strong"),l(11),m(12,"translate"),s()()()()(),a(13,"div")(14,"section",7)(15,"header",8)(16,"h2",9),l(17),m(18,"translate"),a(19,"sup",10)(20,"a",11)(21,"span",12),l(22),m(23,"translate"),s(),l(24),s()()()(),a(25,"div",13)(26,"lib-file-reader",14),v("complete",function(c){return e.processFile(c)}),F(27,"app-filereader-instruction",15),s()()()(),a(28,"div",16),F(29,"lib-error-summary",17),s(),a(30,"div")(31,"section",7)(32,"header",8)(33,"h2",9),l(34),m(35,"translate"),a(36,"sup",10)(37,"a",11)(38,"span",12),l(39),m(40,"translate"),s(),l(41),s()()()(),a(42,"div",13)(43,"app-company-enrolment",18),v("errorList",function(c){return e.processCompanyEnrolmentErrors(c)}),s(),a(44,"section",19)(45,"header",8)(46,"h3",9),l(47),m(48,"translate"),a(49,"sup",10)(50,"a",20)(51,"span",12),l(52),m(53,"translate"),s(),l(54),s()()()(),a(55,"div",13)(56,"app-company-address-list",21),v("errorEmit",function(c){return e.processAddressListErrors(c)}),s()()(),a(57,"section",19)(58,"header",8)(59,"h3",9),l(60),m(61,"translate"),a(62,"sup",10)(63,"a",20)(64,"span",12),l(65),m(66,"translate"),s(),l(67),s()()()(),a(68,"div",13)(69,"app-company-contact-list",22),v("errorEmit",function(c){return e.processContactListErrors(c)}),s()()(),a(70,"app-product-line",23),v("errorList",function(c){return e.processProductLineErrors(c)}),s()()()(),g(71,et,11,8,"div",24),a(72,"div",25),g(73,tt,4,3,"div",26)(74,it,4,3,"div",26)(75,rt,4,4,"div",26)(76,nt,4,6,"div",26),s(),g(77,ot,2,3,"div",24),s()()),i&2&&(p("id",e.popupId)("title",d(1,56,"popup.title"))("message",d(2,58,"msg.save.xml.popup"))("close",d(3,60,"popup.close")),r(5),p("formGroup",e.coForm),r(6),_("\xA0",d(12,62,"PROTECTED_B"),""),r(6),_("",d(18,64,"load.file")," "),r(2),p("id",e.helpIndex.loadFileIndx[2]),r(),p("href","#"+e.helpIndex.loadFileIndx[1],b),r(2),f(d(23,66,"instruction")),r(2),f(e.helpIndex.loadFileIndx[0]),r(2),p("rootTag",e.rootTagText)("lang",e.lang)("versionTagPath",e.versionTagPath)("startCheckSumVersion",e.startCheckSumVersionNum)("byPassCheckSum",e.byPassCheckSum)("devEnv",e.devEnv),r(),p("lang",e.lang)("isInternal",e.isInternal)("isStatusFinal",e.isStatusFinal),r(2),p("hiddenSummary",e.hideErrorSummary())("errorList",e.errorList)("headingLevel",e.headingLevel),r(5),_("",d(35,68,"company.enrolment")," "),r(2),p("id",e.helpIndex.companyEnrolmentIndx[2]),r(),p("href","#"+e.helpIndex.companyEnrolmentIndx[1],b),r(2),f(d(40,70,"instruction")),r(2),f(e.helpIndex.companyEnrolmentIndx[0]),r(2),p("showErrors",e.showErrors)("dataModel",e.companyEnrolModel)("isInternal",e.isInternal),r(4),_("",d(48,72,"address.rep")," "),r(2),p("id",e.helpIndex.addressInfoIndx[2]),r(),p("href","#"+e.helpIndex.addressInfoIndx[1],b),r(2),f(d(53,74,"instruction")),r(2),f(e.helpIndex.addressInfoIndx[0]),r(2),p("recordList",e.addressListModel)("showErrors",e.showErrors)("isInternal",e.isInternal)("earlyVersion",e.isEarlyVersion()),r(4),_("",d(61,76,"company.rep")," "),r(2),p("id",e.helpIndex.companyRepIndx[2]),r(),p("href","#"+e.helpIndex.companyRepIndx[1],b),r(2),f(d(66,78,"instruction")),r(2),f(e.helpIndex.companyRepIndx[0]),r(2),p("recordList",e.contactListModel)("showErrors",e.showErrors)("isInternal",e.isInternal),r(),p("showErrors",e.showErrors)("dataModel",e.companyEnrolModel),r(),p("ngIf",!e.isInternal),r(2),p("ngIf",!e.isInternal),r(),p("ngIf",e.isInternal),r(),p("ngIf",!e.isInternal),r(),p("ngIf",!e.isInternal),r(),p("ngIf",e.showMailToHelpText))},dependencies:[P,V,N,k,ye,ue,ce,me,de,fe,he,ve,Le,Fe,Se,Ee,O,Ce,ge,je,Q,$,Oe,Xe,Ne,D,Pe,z,xe],encapsulation:2})}}return o})();export{qt as FormBaseComponent};
