import{$ as ie,A as C,Aa as le,Ab as U,B as ee,Ba as ce,Bb as Ae,Ca as de,D as r,Da as pe,E as v,Ea as me,Fa as ue,G as I,Ga as he,Ha as fe,J as c,K as n,Ka as N,L as o,M as x,Ma as ve,N as H,Na as _e,O as Q,Oa as y,P as te,Pa as ge,Q as _,Qa as ye,R as L,Sa as A,T as F,Ta as Ee,U as b,Ua as k,V as M,Va as K,W as s,Wa as V,X as h,Xa as Se,Y as g,Ya as Ce,_a as q,aa as w,ba as d,ca as p,cb as Ie,da as re,eb as Fe,fa as R,fb as be,hb as O,i as J,ib as Me,k as u,kb as Te,l as Y,la as B,lb as xe,ma as P,mb as Le,n as T,q as Z,qb as W,r as $,sb as j,tb as we,ub as Re,vb as Be,wa as oe,wb as D,xa as ne,xb as Pe,ya as ae,yb as G,za as se,zb as Ne}from"./chunk-RFUW6LMT.js";var X=(()=>{class l{constructor(e,i,t,a,m,E,f,S,Oe,je){this._entityBaseService=e,this._utilsService=i,this._globalService=t,this._regulatoryInfoService=a,this._transactionDetailsService=m,this._feesService=E,this._regulatoryContactService=f,this._addressDetailsService=S,this._contactDetailsService=Oe,this._entityBasePbvService=je}getReactiveModel(e){return e?e.group({certifyPrivacy:[!1,se.required]}):null}getEmptyEnrol(){return{TRANSACTION_ENROL:this.getEmptyTransactionEnrol()}}getEmptyFeesModel(){return{submission_class:void 0,submission_description:void 0,mitigation:this.getEmptyMitigation()}}getEmptyTransactionEnrol(){return{template_type:"PHARMA",date_saved:void 0,software_version:"",form_language:"",check_sum:"",ectd:this.getEmptyEctd(),fee_details:this.getEmptyFeesModel(),is_third_party:"",company_name:"",regulatory_activity_address:this._entityBasePbvService.getEmptyAddressDetailsModel(),regulatory_activity_contact:this._entityBasePbvService.getEmptyContactModel(),confirm_regulatory_contact:"",is_priority:"",is_noc:"",is_admin_sub:"",sub_type:void 0}}getEmptyEctd(){return{company_id:"",dossier_id:"",dossier_type:void 0,product_name:"",lifecycle_record:this.getEmptyLifecycleRecord()}}getEmptyLifecycleRecord(){return{control_number:"",regulatory_activity_lead:void 0,regulatory_activity_type:void 0,sequence_description_value:void 0,sequence_from_date:"",sequence_to_date:"",sequence_details:"",sequence_details_change:"",sequence_version:"",sequence_year:"",transaction_description:void 0,requester_name:"",requester_name2:"",requester_name3:"",requester_of_solicited_information:""}}getEmptyMitigation(){return{certify_funded_health_institution:"",certify_government_organization:"",certify_organization:"",certify_urgent_health_need:"",certify_isad:"",mitigation_type:void 0,small_business_fee_application:""}}mapRegulatoryInfoFormToOutput(e,i){this._regulatoryInfoService.mapFormModelToDataModel(i,e),this._transactionDetailsService.mapFormModelToDataModel(i,e.ectd.lifecycle_record)}mapFeesFormToOutput(e,i){this._feesService.mapFormModelToDataModel(i,e)}mapRegContactInfoToOutput(e,i,t,a){this._regulatoryContactService.mapFormModelToDataModel(i,e,t,a)}static{this.\u0275fac=function(i){return new(i||l)(u(A),u(y),u(j),u(we),u(Be),u(Pe),u(Ne),u(Fe),u(be),u(Ie))}}static{this.\u0275prov=J({token:l,factory:l.\u0275fac})}}return l})();function ze(l,z){l&1&&(H(0),n(1,"p"),s(2,'First time users of this form cannot select a file to load and must create an XML file by completing all the required fields below and clicking on the "Generate XML" button at the bottom of this form.'),o(),n(3,"p"),s(4,'For subsequent uses of this form, you can either upload a file by clicking on the "Choose file" button and selecting the .hcsc file or .xml file or you can complete the required fields below to generate a .xml file.'),o(),n(5,"p"),s(6,'If you partially complete the form and click on the "Save working copy" button at the bottom of the form it will save a copy on the local workstation for completion at a later time. The file will be saved in the .hcsc file format. If you are using a previously submitted .xml file, please update the appropriate fields and verify that the details are accurate for the current transaction prior to filing.'),o(),n(7,"p"),s(8,"Note: The working copies (files with extension .hcsc) should never be sent to Health Canada."),o(),Q())}function He(l,z){l&1&&(H(0),n(1,"p"),s(2,"Les nouveaux utilisateurs du formulaire ne peuvent pas s\xE9lectionner et t\xE9l\xE9charger un fichier. Ceci \xE9tant dit, ils doivent cr\xE9er un fichier XML en remplissant les champs obligatoires ci-dessous et en cliquant sur le bouton \xABG\xE9n\xE9rer le XML \xBB au bas du formulaire."),o(),n(3,"p"),s(4,"Pour les utilisations ult\xE9rieures de ce formulaire, vous pouvez soit t\xE9l\xE9charger un fichier en cliquant sur le bouton \xABChoisir un fichier\xBB et en s\xE9lectionnant le fichier en format .hcsc ou .xml, soit remplir les champs obligatoires ci-dessous afin de g\xE9n\xE9rer un fichier .xml."),o(),n(5,"p"),s(6,"Si vous remplissez partiellement le formulaire et souhaiter proc\xE9der ult\xE9rieurement, cliquez sur le bouton \xABEnregistrer la copie de travail\xBB au bas du formulaire. Une copie sera enregistr\xE9e sur le poste de travail en format .hcsc. Si vous utilisez un fichier .xml pr\xE9c\xE9demment soumis, veuillez mettre \xE0 jour les champs appropri\xE9s et v\xE9rifier que les d\xE9tails sont exacts pour la transaction actuelle avant de d\xE9poser le formulaire."),o(),n(7,"p"),s(8,"Remarque: les copies de travail (fichiers portant l'extension .hcsc) ne doivent jamais \xEAtre envoy\xE9es \xE0 Sant\xE9 Canada."),o(),Q())}var Ve=(()=>{class l{static{this.\u0275fac=function(i){return new(i||l)}}static{this.\u0275cmp=T({type:l,selectors:[["app-filereader-instruction"]],inputs:{lang:"lang"},standalone:!0,features:[w],decls:4,vars:2,consts:[[1,"row"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],[4,"ngIf"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"div",1),I(2,ze,9,0,"ng-container",2)(3,He,9,0,"ng-container",2),o()()),i&2&&(r(2),c("ngIf",t.lang==="en"),r(),c("ngIf",t.lang==="fr"))},dependencies:[P,B],encapsulation:2})}}return l})();function Qe(l,z){if(l&1){let e=te();n(0,"section",6)(1,"header",7)(2,"h2",8),s(3),d(4,"translate"),n(5,"sup",9)(6,"a",10)(7,"span",11),s(8),d(9,"translate"),o(),s(10),o()()()(),n(11,"div",12)(12,"app-fees",17),_("errorList",function(t){Z(e);let a=L();return $(a.processFeesErrors(t))}),o()()()}if(l&2){let e=L();r(3),g("",p(4,7,"panel.title.fees")," "),r(2),c("id",e.helpIndex.feesIndx[2]),r(),c("href","#"+e.helpIndex.feesIndx[1],C),r(2),h(p(9,9,"instruction")),r(2),h(e.helpIndex.feesIndx[0]),r(2),c("showErrors",e.showErrors)("dataModel",e.feesModel)}}function Ke(l,z){if(l&1&&(x(0,"control-messages",31),d(1,"formControl")),l&2){let e=L();c("showError",e.showErrors)("control",p(1,2,e.rtForm.controls.certifyPrivacy))}}var Mt=(()=>{class l{constructor(e,i,t,a,m,E,f,S){this._fb=e,this.cdr=i,this._baseService=t,this._globalService=a,this._utilsService=m,this.fileServices=E,this._versionService=f,this._checkSumService=S,this._regulatoryInfoErrors=[],this._regulatoryContactErrors=[],this._feesErrors=[],this._consertPrivacyError=[],this.errorList=[],this.headingLevel="h2",this.rootTagText=O,this.versionTagPath=Me,this.startCheckSumVersionNum=5,this.noFeeRALeads=[W.POST_MARKET_VIGILANCE],this._signalService=Y(Re),this.selectedDossierType=this._signalService.getSelectedDossierType(),this.isPharmaBio=this._signalService.isPharmaBio(),this.selectedRALead=this._signalService.getSelectedRaLead(),this.isRALeadPostMarket=R(()=>this.selectedRALead()===W.POST_MARKET_VIGILANCE),this.signed3rdParty=this._signalService.getSigned3rdParty(),this.isNotSigned3rdParty=R(()=>this.signed3rdParty()===Le),this.showFees=R(()=>!!(this._utilsService.isEmpty(this.selectedDossierType())||this.isPharmaBio()&&!this.noFeeRALeads.includes(this.selectedRALead()))),this.showErrors=!1}ngOnInit(){this.rtForm||(this.rtForm=this._baseService.getReactiveModel(this._fb));try{this._globalService.enrollment?this.enrollModel=this._globalService.enrollment:(this.enrollModel=this._baseService.getEmptyEnrol(),this._globalService.enrollment=this.enrollModel),this.transactionEnrollModel=this.enrollModel[this.rootTagText],this._initModels(this.transactionEnrollModel),this.lang=this._globalService.currLanguage,this.helpIndex=this._globalService.helpIndex,this.devEnv=this._globalService.devEnv,this.byPassCheckSum=this._globalService.byPassChecksum}catch(e){console.error(e)}}ngAfterViewInit(){document.location.href="#def-top",this.msgList.changes.subscribe(e=>{let i=[];this._updateErrorList(e),this.processErrors()}),this.msgList.notifyOnChanges()}_updateErrorList(e){let i=[];e&&e.forEach(t=>{t.label==="consent.privacy"&&i.push(t)}),this._consertPrivacyError=i}processErrors(){this.errorList=[],this.errorList=this.errorList.concat(this._regulatoryInfoErrors),this.showFees()&&(this.errorList=this.errorList.concat(this._feesErrors)),this.errorList=this.errorList.concat(this._regulatoryContactErrors),this.errorList=this.errorList.concat(this._consertPrivacyError),console.log(this.errorList),this.cdr.detectChanges()}processRegulatoryInfoErrors(e){this._regulatoryInfoErrors=e,this.processErrors()}processContactInfoErrors(e){this._regulatoryContactErrors=e,this.processErrors()}processFeesErrors(e){this._feesErrors=e,this.processErrors()}hideErrorSummary(){return this.showErrors&&this.errorList&&this.errorList.length>0}saveXmlFile(){this.showErrors=!0,this.processErrors(),this._saveXML()}saveWorkingCopyFile(){let e=this._prepareForSaving(!1),i=this._generateFileName(e[O]);this.fileServices.saveJsonToFile(e,i,null)}processFile(e){if(e.data!==null&&(this.transactionEnrollModel=e.data.TRANSACTION_ENROL,this._initModels(this.transactionEnrollModel),this._versionService.getMajorVersion(this.transactionEnrollModel.software_version)<5&&this.addressModel.country._id!="")){let i=this._globalService.countryIdMappingList.find(t=>t.id===this.addressModel.country._id);i!=null&&(this.addressModel.country._id=i.newid)}}_initModels(e){this.ectdModel=e.ectd,e.fee_details!=null&&(this.feesModel=e.fee_details),this.addressModel=e.regulatory_activity_address,this.contactModel=e.regulatory_activity_contact}preload(){}unloadNotification(e){e.returnValue=!0}_saveXML(){if(this.errorList&&this.errorList.length<1){let e=this._prepareForSaving(!0),i=this._generateFileName(e[O]),t=this._versionService.getApplicationMajorVersionWithUnderscore(this._globalService.appVersion),a=xe.toUpperCase()+"_RT_"+t+".xsl";this.fileServices.saveXmlToFile(e,i,!0,a);return}document.location.href="#topErrorSummaryId"}_prepareForSaving(e){let i=this._baseService.getEmptyTransactionEnrol(),t=this.regulatoryInfoComponent.getFormValue();if(this._baseService.mapRegulatoryInfoFormToOutput(i,t),this.showFees()){let S=this.feesComponent.getFormValue();this._baseService.mapFeesFormToOutput(i.fee_details,S)}else i.fee_details=null;let a=this.regulatoryContactComponent.getFormValue(),m=null;this.isNotSigned3rdParty()||(m=this.regulatoryContactComponent.getAddressFormValue());let E=this.regulatoryContactComponent.getContactFormValue();this._baseService.mapRegContactInfoToOutput(i,a,m,E),i.date_saved=this._utilsService.getFormattedDate("yyyy-MM-dd-hhmm"),i.software_version=this._globalService.appVersion,i.form_language=this._globalService.currLanguage;let f={TRANSACTION_ENROL:i};return e&&(f.TRANSACTION_ENROL[K]="",f.TRANSACTION_ENROL[K]=this._checkSumService.createHash(f)),console.log("_prepareForSaving ~ output",JSON.stringify(f,null,2)),f}_generateFileName(e){let i=e.ectd.dossier_id?e.ectd.dossier_id:"";return Te+"-"+i+"-"+e.date_saved}onChanged(e,i){e?.target?.checked===!1&&this.rtForm.controls[i].reset()}static{this.\u0275fac=function(i){return new(i||l)(v(he),v(re),v(X),v(j),v(y),v(k),v(q),v(V))}}static{this.\u0275cmp=T({type:l,selectors:[["app-form-base"]],viewQuery:function(i,t){if(i&1&&(F(D,5),F(G,5),F(U,5),F(N,5)),i&2){let a;b(a=M())&&(t.regulatoryInfoComponent=a.first),b(a=M())&&(t.feesComponent=a.first),b(a=M())&&(t.regulatoryContactComponent=a.first),b(a=M())&&(t.msgList=a)}},hostBindings:function(i,t){i&1&&_("beforeunload",function(m){return t.unloadNotification(m)},!1,ee)},standalone:!0,features:[ie([k,y,q,V,Ee,A,X]),w],decls:74,vars:62,consts:[[1,"container-fluid","wb-frmvld","wb-init","wb-frmvld-inited"],["name","transactionForm","novalidate","",3,"formGroup"],[1,"row","mrgn-tp-md"],[1,"col-md-12"],[1,"text-right"],["id","securityInfo",1,"fa","fa-shield","fa-sm"],[1,"panel","panel-primary","mrgn-tp-lg"],[1,"panel-heading","clearfix"],[1,"panel-title"],[3,"id"],[1,"fn-lnk","mrgn-tp-md",3,"href"],[1,"wb-inv"],[1,"panel-body"],[3,"complete","rootTag","lang","versionTagPath","startCheckSumVersion","byPassCheckSum","devEnv"],["fileUploadInstruction","",3,"lang"],["id","topErrorSummaryId"],["headingPreamble","errorSummary.form.name",3,"hiddenSummary","errorList","headingLevel"],[3,"errorList","showErrors","dataModel"],["class","panel panel-primary mrgn-tp-lg",4,"ngIf"],[3,"errorList","showErrors","dataModel","addressModel","contactModel"],[1,"row"],[1,"col-lg-12","col-md-12","col-sm-12","col-xs-12"],["for","certifyPrivacy",1,"required"],["type","checkbox","id","certifyPrivacy","required","",3,"blur","formControlName"],[1,"required"],["parentId","transactionForm","controlId","certifyPrivacy","label","consent.privacy",3,"showError","control",4,"ngIf"],[1,"row","btn-group-sm"],[1,"form-group","col-md-4"],["type","button",1,"btn","btn-default","btn-lg","active",3,"click"],["type","button",1,"btn","btn-primary","btn-lg","active",3,"click"],[1,"fn-lnk",3,"href"],["parentId","transactionForm","controlId","certifyPrivacy","label","consent.privacy",3,"showError","control"]],template:function(i,t){i&1&&(n(0,"div",0)(1,"form",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"span",5)(6,"strong"),s(7),d(8,"translate"),o()()()()(),n(9,"div")(10,"section",6)(11,"header",7)(12,"h2",8),s(13),d(14,"translate"),n(15,"sup",9)(16,"a",10)(17,"span",11),s(18),d(19,"translate"),o(),s(20),o()()()(),n(21,"div",12)(22,"lib-file-reader",13),_("complete",function(m){return t.processFile(m)}),x(23,"app-filereader-instruction",14),o()()()(),n(24,"div",15),x(25,"lib-error-summary",16),o(),n(26,"div")(27,"section",6)(28,"header",7)(29,"h2",8),s(30),d(31,"translate"),o()(),n(32,"div",12)(33,"app-regulatory-information",17),_("errorList",function(m){return t.processRegulatoryInfoErrors(m)}),o()()(),I(34,Qe,13,11,"section",18),n(35,"section",6)(36,"header",7)(37,"h2",8),s(38),d(39,"translate"),n(40,"sup",9)(41,"a",10)(42,"span",11),s(43),d(44,"translate"),o(),s(45),o()()()(),n(46,"div",12)(47,"app-regulatory-contact",19),_("errorList",function(m){return t.processContactInfoErrors(m)}),o()()()(),n(48,"div",20)(49,"div",21)(50,"label",22)(51,"input",23),_("blur",function(){return t.processErrors()}),o(),n(52,"strong"),s(53),d(54,"translate"),o(),n(55,"strong",24),s(56),d(57,"translate"),o(),I(58,Ke,2,4,"control-messages",25),o()()(),n(59,"div",26)(60,"div",27)(61,"button",28),_("click",function(){return t.saveWorkingCopyFile()}),s(62),d(63,"translate"),o()(),n(64,"div",27)(65,"button",29),_("click",function(){return t.saveXmlFile()}),s(66),d(67,"translate"),o(),n(68,"sup",9)(69,"a",30)(70,"span",11),s(71),d(72,"translate"),o(),s(73),o()()()()()()),i&2&&(r(),c("formGroup",t.rtForm),r(6),g("\xA0",p(8,40,"PROTECTED_B"),""),r(6),g("",p(14,42,"load.file")," "),r(2),c("id",t.helpIndex.loadFileIndx[2]),r(),c("href","#"+t.helpIndex.loadFileIndx[1],C),r(2),h(p(19,44,"instruction")),r(2),h(t.helpIndex.loadFileIndx[0]),r(2),c("rootTag",t.rootTagText)("lang",t.lang)("versionTagPath",t.versionTagPath)("startCheckSumVersion",t.startCheckSumVersionNum)("byPassCheckSum",t.byPassCheckSum)("devEnv",t.devEnv),r(),c("lang",t.lang),r(2),c("hiddenSummary",t.hideErrorSummary())("errorList",t.errorList)("headingLevel",t.headingLevel),r(5),h(p(31,46,"panel.title.regulatory.info")),r(3),c("showErrors",t.showErrors)("dataModel",t.transactionEnrollModel),r(),c("ngIf",t.showFees()),r(4),g("",p(39,48,"panel.title.reg.contact")," "),r(2),c("id",t.helpIndex.regContactIndx[2]),r(),c("href","#"+t.helpIndex.regContactIndx[1],C),r(2),h(p(44,50,"instruction")),r(2),h(t.helpIndex.regContactIndx[0]),r(2),c("showErrors",t.showErrors)("dataModel",t.transactionEnrollModel)("addressModel",t.addressModel)("contactModel",t.contactModel),r(4),c("formControlName","certifyPrivacy"),r(2),g(" ",p(54,52,"consent.privacy"),""),r(3),h(p(57,54,"commmon.required.bracket")),r(2),c("ngIf",t.rtForm.controls.certifyPrivacy.invalid),r(4),g(" ",p(63,56,"save.working.copy")," "),r(4),g(" ",p(67,58,"generate.final")," "),r(2),c("id",t.helpIndex.genFinalIndx[2]),r(),c("href","#"+t.helpIndex.genFinalIndx[1],C),r(2),h(p(72,60,"instruction")),r(2),h(t.helpIndex.genFinalIndx[0]))},dependencies:[P,B,ne,oe,fe,de,ae,le,ce,ue,pe,me,Ce,Se,ye,ve,N,ge,_e,Ae,D,U,G,Ve],encapsulation:2})}}return l})();export{Mt as FormBaseComponent};
